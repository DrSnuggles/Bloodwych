<!DOCTYPE html>
<html>
	<head>
		<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>
	</head>
	<body>
		<select name="Colour" id="colour">
			<option value="white">White</option>
			<option value="red" style="color:red;">Red</option>
			<option value="blue" style="color:blue;">Blue</option>
			<option value="green" style="color:green;">Green</option>
			<option value="black">Black</option>
		</select>
	</body>
	<script type="text/javascript">
	$(function () {
		var socketio = io.connect("127.0.0.1:1337"); //86.24.136.220

		socketio.on("message_to_client", function(data) {
			var data = data['message'].split(',');
			var col = data[0];
			var x = parseInt(data[2]);
			var y = parseInt(data[1]);
			$('table').find('tr:nth-child(' + (x + 1) + ')').find('td:nth-child(' + (y + 1) + ')').css('background-color', col);
		});

		function sendMessage(data) {
			socketio.emit("message_to_server", { message : data});
		}

		$('body').on('click', 'td', function() {
			var col = $('#colour').val();
			var x = $(this).index();
			var y = $(this).parent().index();
			var data = col + ',' + x + ',' + y;
			sendMessage(data);
		});

		$('body').append('<table border="1" cellpadding="10" cellspacing="0">');
		for(i = 0; i < 20; i++) {
			$('table').append('<tr>');
		}
		for(i = 0; i < 20; i++) {
			$('tr').append('<td>');
		}

		socketio.on("init_to_client", function(data) {
			var cols = data['message'].split(',');
			var i = 0;
			var col = '';
			for(y = 0; y < 20; y++) {
				for(x = 0; x < 20; x++) {
					if(typeof cols[i] === "undefined") {
						break;
					} else {
						switch(data[i]) {
							case '0': col = 'white'; break;
							case '1': col = 'red'; break;
							case '2': col = 'blue'; break;
							case '3': col = 'green'; break;
							case '4': col = 'black'; break;
							default: col = ''; break;
						}
						$('table').find('tr:nth-child(' + (x + 1) + ')').find('td:nth-child(' + (y + 1) + ')').css('background-color', col);
						i++;
					}
				}
				if(typeof cols[i] === "undefined") {
					break;
				}
			}
		});
	});
	</script>
</html>
